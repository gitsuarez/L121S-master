<?php $soundData = erLhcoreClassModelChatConfig::fetch('sync_sound_settings')->data; $soundMessageEnabled = erLhcoreClassModelUserSetting::getSetting('chat_message',(int)($soundData['new_message_sound_admin_enabled'])); $soundNewChatEnabled = erLhcoreClassModelUserSetting::getSetting('new_chat_sound',(int)($soundData['new_chat_sound_enabled'])); $canChangeOnlineStatus = false; $currentUser = erLhcoreClassUser::instance(); if ( $currentUser->hasAccessTo('lhuser','changeonlinestatus') ) { $canChangeOnlineStatus = true; if ( !isset($UserData) ) { $UserData = $currentUser->getUserData(true); } } $canChangeVisibilityMode = false; if ( $currentUser->hasAccessTo('lhuser','changevisibility') ) { $canChangeVisibilityMode = true; if ( !isset($UserData) ) { $UserData = $currentUser->getUserData(true); } } ?><?php  if ($currentUser->hasAccessTo('lhchat','use') ) : ?><?php  if (!isset($hideULSetting)) : ?><ul class="list-inline user-settings-list pull-right"><?php  endif;?><li><a href="#"><i class="material-icons" onclick="return lhinst.disableChatSoundAdmin($(this))" title="Enable/Disable sound about new messages from users"><?php  $soundMessageEnabled == 0 ? print 'volume_off' : print 'volume_up'?></i></a></li><li><a href="#"><i class="material-icons" onclick="return lhinst.disableNewChatSoundAdmin($(this))" title="Enable/Disable sound about new pending chats"><?php  $soundNewChatEnabled == 0 ? print 'volume_off' : print 'volume_up'?></i></a></li><?php  if ($canChangeVisibilityMode == true) : ?><li><a href="#"><i id="vi-in-user" class="material-icons" title="Change my visibility to visible/invisible" onclick="return lhinst.changeVisibility($(this))"><?php  $UserData->invisible_mode == 1 ? print 'visibility_off' : print 'visibility'?></i><span class="menu-status-txt" id="visibility" onclick="return lhinst.changeVisibility($('#vi-in-user'))"><?php  $UserData->invisible_mode == 1 ? print 'invisible' : print 'visible'?></span></a></li><?php  endif;?><?php  if ($canChangeOnlineStatus == true) : ?><li><a href="#"><i id="online-offline-user" class="material-icons" title="Change my status to online/offline" onclick="return lhinst.disableUserAsOnline($(this))"><?php  $UserData->hide_online == 1 ? print 'flash_off' : print 'flash_on'?></i><span class="menu-status-txt" id="online-status" onclick="return lhinst.disableUserAsOnline($('#online-offline-user'))"><?php  $UserData->hide_online == 1 ? print 'offline' : print 'online'?></span></a></li><?php  endif;?><?php  if (!isset($hideULSetting)) : ?></ul><?php  endif;?><?php  endif;?><?php $pendingTabEnabled = erLhcoreClassModelUserSetting::getSetting('enable_pending_list',1); $activeTabEnabled = erLhcoreClassModelUserSetting::getSetting('enable_active_list',1); $closedTabEnabled = erLhcoreClassModelUserSetting::getSetting('enable_close_list',0); $unreadTabEnabled = erLhcoreClassModelUserSetting::getSetting('enable_unread_list',1); ?><div role="tabpanel" ng-cloak id="tabs"><!-- Nav tabs -->
<ul class="nav nav-pills" role="tablist"><?php  if ($pendingTabEnabled == true) : ?><li role="presentation" class="active"><a title="Pending confirm" href="#panel1" aria-controls="panel1" role="tab" data-toggle="tab"><i class="material-icons chat-pending mr-0">chat</i><span>{{pending_chats.list.length != false && pending_chats.list.length > 0 ? ' ('+pending_chats.list.length+')' : ''}}</span></a></li><?php  endif;?><?php  if ($activeTabEnabled == true) : ?><li role="presentation"><a title="Active chats" href="#panel2" aria-controls="panel2" role="tab" data-toggle="tab"><i class="material-icons chat-active mr-0">chat</i><span>{{active_chats.list.length != false && active_chats.list.length > 0 ? ' ('+active_chats.list.length+')' : ''}}</span></a></li><?php  endif;?><?php  if ($unreadTabEnabled == true) : ?><li role="presentation"><a title="Unread messages" href="#panel3" aria-controls="panel3" role="tab" data-toggle="tab"><i class="material-icons chat-unread mr-0">chat</i><span>{{unread_chats.list.length != false && unread_chats.list.length > 0 ? ' ('+unread_chats.list.length+')' : ''}}</span></a></li><?php  endif;?><?php  if ($closedTabEnabled == true) : ?><li role="presentation"><a title="Closed chats" href="#panel4" aria-controls="panel4" role="tab" data-toggle="tab"><i class="material-icons chat-closed mr-0">chat</i><span>{{closed_chats.list.length != false && closed_chats.list.length > 0 ? ' ('+closed_chats.list.length+')' : ''}}</span></a></li><?php  endif;?></ul><!-- Tab panes -->
<div class="tab-content"><?php  if ($pendingTabEnabled == true) : ?><div role="tabpanel" class="tab-pane active" id="panel1"><div id="pending-chat-list"><ul class="list-unstyled fs12"><li ng-repeat="chat in pending_chats.list track by chat.id" ng-class="{'icon-user-away': chat.user_status_front == 2, 'icon-user-online': chat.user_status_front == 0}"><span ng-if="chat.country_code != undefined"><img ng-src="/richard/sites/live121support.com-master/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><i class="material-icons" ng-show="chat.plain_user_name" title="Assigned operator - {{chat.plain_user_name}}">account_box</i><a class="material-icons" title="ID - {{chat.id}}" ng-click="lhc.previewChat(chat.id)">info_outline</a><a class="material-icons" title="Redirect user to contact form." ng-click="lhc.redirectContact(chat.id,'Are you sure?')" >reply</a><a class="right-action-hide material-icons" ng-click="lhc.startChat(chat.id,chat.nick)" title="Accept chat">chat</a><a title="Open in a new window" class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)">open_in_new</a>{{chat.nick}}, <small><b>{{chat.wait_time_pending}}</b></small>, {{chat.department_name}}{{chat.plain_user_name !== undefined ? ' | ' + chat.plain_user_name : ''}}</li></ul><p ng-show="pending_chats.list.length == 0">Empty...</p></div><a class="btn btn-default btn-sm" href="/richard/sites/live121support.com-master/index.php/site_admin/chat/list/(chat_status)/0">All pending chats</a></div><?php  endif;?><?php  if ($activeTabEnabled == true) : ?><div role="tabpanel" class="tab-pane" id="panel2"><div id="active-chat-list"><ul class="list-unstyled fs12"><li ng-repeat="chat in active_chats.list track by chat.id" ng-class="{'icon-user-away': chat.user_status_front == 2, 'icon-user-online': chat.user_status_front == 0}"><span ng-if="chat.country_code != undefined"><img ng-src="/richard/sites/live121support.com-master/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><a class="material-icons" title="ID - {{chat.id}}" ng-click="lhc.previewChat(chat.id)" >info_outline</a><a class="right-action-hide material-icons" ng-click="lhc.startChat(chat.id,chat.nick)" title="Add chat">chat</a><a class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)" title="Open in a new window">open_in_new</a>{{chat.nick}}, <small><i>{{chat.time_created_front}},</i></small> {{chat.department_name}} | {{chat.plain_user_name}}</li></ul><p ng-show="active_chats.list.length == 0">Empty...</p></div><a class="btn btn-default btn-sm" href="/richard/sites/live121support.com-master/index.php/site_admin/chat/list/(chat_status)/1">All active chats</a></div><?php  endif;?><?php  if ($unreadTabEnabled == true) : ?><div role="tabpanel" class="tab-pane" id="panel3"><div id="unread-chat-list"><ul class="list-unstyled fs12"><li ng-repeat="chat in unread_chats.list track by chat.id" ng-class="{'icon-user-away': chat.user_status_front == 2, 'icon-user-online': chat.user_status_front == 0}"><span ng-if="chat.country_code != undefined"><img ng-src="/richard/sites/live121support.com-master/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><a class="material-icons" title="ID - {{chat.id}}" ng-click="lhc.previewChat(chat.id)" >info_outline</a><a class="right-action-hide material-icons" ng-click="lhc.startChat(chat.id,chat.nick)" title="Add chat">chat</a><a class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)" title="Open in a new window">open_in_new</a>{{chat.nick}}, {{chat.time_created_front}}, {{chat.department_name}} | <b>{{chat.unread_time.hours}} h. {{chat.unread_time.minits}} m. {{chat.unread_time.seconds}} s. ago.</b></li></ul><p ng-show="unread_chats.list.length == 0">Empty...</p></div><a class="btn btn-default btn-sm" href="/richard/sites/live121support.com-master/index.php/site_admin/chat/list/(hum)/1">All unread chats</a></div><?php  endif;?><?php  if ($closedTabEnabled == true) : ?><div role="tabpanel" class="tab-pane" id="panel4"><div id="closed-chat-list"><ul class="list-unstyled fs12"><li ng-repeat="chat in closed_chats.list track by chat.id" ng-class="{'icon-user-away': chat.user_status_front == 2, 'icon-user-online': chat.user_status_front == 0}"><span ng-if="chat.country_code != undefined"><img ng-src="/richard/sites/live121support.com-master/design/defaulttheme/images/flags/{{chat.country_code}}.png" alt="{{chat.country_name}}" title="{{chat.country_name}}" /></span><a class="material-icons" title="ID - {{chat.id}}" ng-click="lhc.previewChat(chat.id)" >info_outline</a><a class="right-action-hide material-icons" ng-click="lhc.startChat(chat.id,chat.nick)" title="Add chat">chat</a><a class="material-icons" ng-click="lhc.startChatNewWindow(chat.id,chat.nick)" title="Open in a new window">open_in_new</a>{{chat.nick}}, <small><i>{{chat.time_created_front}},</i></small> {{chat.department_name}} | {{chat.plain_user_name}}</li></ul><p ng-show="closed_chats.list.length == 0">Empty...</p></div><a class="btn btn-default btn-sm" href="/richard/sites/live121support.com-master/index.php/site_admin/chat/list/(chat_status)/2">All closed chats</a></div><?php  endif;?></div></div><script type="text/javascript">function addChat(chat_id,name){lhinst.startChat(chat_id,$('#tabs'),name);window.focus();};lhinst.attachTabNavigator();<?php $chatsOpen = CSCacheAPC::getMem()->getArray('lhc_open_chats'); if (!empty($chatsOpen)){ $chats = erLhcoreClassChat::getList(array('filterin' => array('id' => $chatsOpen))); $deleteKeys = array_diff($chatsOpen, array_keys($chats)); foreach ($deleteKeys as $chat_id) { CSCacheAPC::getMem()->removeFromArray('lhc_open_chats', $chat_id); } foreach ($chats as $chat ){ if (erLhcoreClassChat::hasAccessToRead($chat)){ echo "lhinst.startChat('$chat->id',$('#tabs'),'".erLhcoreClassDesign::shrt($chat->nick,10,'...',30,ENT_QUOTES)."',false);"; } else { CSCacheAPC::getMem()->removeFromArray('lhc_open_chats', $chat->id); } } } ?></script>